<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 简单Lua教程 · YDWE官方博客</title><meta name="description" content="简单Lua教程 - actboy168"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.ydwe.net/atom.xml" title="YDWE官方博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">主页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">目录</a></li><li class="nav-list-item"><a href="/download.html" target="_self" class="nav-list-link">下载</a></li><li class="nav-list-item"><a href="https://github.com/actboy168/YDWE" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">简单Lua教程</h1><div class="post-info">Apr 15, 2014</div><div class="post-content"><p>本文旨在让有jass基础的用户快速上手Lua,因此需要一定的jass基础.当然如果你有其他语言的基础那更好</p>
<a id="more"></a>
<p>##1.准备工作</p>
<p>最新版本的<a href="http://www.ydwe.net/download.html" target="_blank" rel="external">YDWE</a></p>
<p>建议在配置中关闭预处理器,因为它和Lua的一个符号有冲突,当然你也可以选择回避使用这个符号.</p>
<p>##2.入口</p>
<p>使用<figure class="highlight plain"><figcaption><span>Cheat("exec-lua: filename")```来运行地图中名称为"filename"的lua脚本</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">你可以选择在外部编写该脚本后导入地图,也可以通过YDWE在编辑器内编写并自动导入地图</div><div class="line"></div><div class="line">##3.在YDWE内写Lua脚本</div><div class="line"></div><div class="line">在YDWE的任何自定义代码区域输入以下内容</div><div class="line"></div><div class="line">```lua</div><div class="line">&lt;?import(&quot;filename&quot;)[[</div><div class="line"></div><div class="line">	script</div><div class="line">		</div><div class="line">]]?&gt;</div></pre></td></tr></table></figure></p>
<p>这段代码等价于你在地图内导入了一个名字为”filename”,内容为”script”的脚本</p>
<p>你可能迫不及待想要尝试写Lua了,不过在这里我要建议你在运行自己的Lua脚本之前,先<strong>单独</strong>运行一次以下代码(通过<figure class="highlight plain"><figcaption><span>Cheat("exec-lua: MU_console")```)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">```lua</div><div class="line">&lt;?import(&quot;MU_console.lua&quot;)[[</div><div class="line"></div><div class="line">	require(&quot;jass.runtime&quot;).console = true</div><div class="line">	</div><div class="line">]]?&gt;</div></pre></td></tr></table></figure></p>
<p>这段代码的效果是打开一个控制台窗口,这样如果你的其他Lua代码出现了错误,控制台窗口中将会显示出错误原因和错误位置,非常便利.此外通过Lua的print函数,你也可以将各种内容显示在这里</p>
<p>##4.hello world</p>
<p>没错,第一步是hello world</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="string">"hello world"</span>)</div></pre></td></tr></table></figure>
<p>控制台窗口中将会显示”hello world”</p>
<p>##5.Lua的基本介绍</p>
<p>lua是一个简单,高效,强大的脚本语言,其语法和jass有很多相似之处,因此有jass基础的话可以很快掌握lua</p>
<p>lua和jass最大的不同在于lua不需要定义变量类型,例:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> a = <span class="number">1</span></div><div class="line"><span class="keyword">if</span> a == <span class="number">1</span> <span class="keyword">then</span></div><div class="line">	a = <span class="string">"等于1"</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在这个例子中,a的类型分别为数字(number)与字符串(string)</p>
<p>lua的注释符为 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">你也可以进行多行注释</div><div class="line"></div><div class="line">```lua</div><div class="line">	--[[</div><div class="line">		我已经被注释掉了</div><div class="line">	--]]</div></pre></td></tr></table></figure></p>
<p>####在lua中有以下几个类型:</p>
<ul>
<li><p>nil   空值,任何变量在赋值前都是nil,给变量赋值nil相当于摧毁该变量,类似于jass中的null</p>
</li>
<li><p>boolean   布尔值,与jass一样包含true与false</p>
</li>
<li><p>number   数字,lua中的数字没有整数或实数之分,因此在lua中 5 / 2 == 2.5</p>
</li>
<li><p>string   字符串,与jass中的字符串基本相同</p>
</li>
<li><p>table   表,lua中最强大的类型,他可以简单的当做数组或哈希表使用,更是lua构成复杂的高级功能的基础,这将在之后重点学习</p>
</li>
<li><p>function   函数,与jass中的函数不同,lua中的函数也被视为一个值,你可以随时将它赋值给一个变量,或在其他函数中作为参数或返回值传递</p>
</li>
<li><p>userdata   自定义数据,你可以将其理解为jass中的handle,lua无法直接对其进行修改</p>
</li>
</ul>
<p>####lua有以下几个保留字:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">and</span> <span class="keyword">break</span> <span class="keyword">do</span> <span class="keyword">else</span> <span class="keyword">elseif</span></div><div class="line"><span class="keyword">end</span> <span class="literal">false</span> <span class="keyword">for</span> <span class="function"><span class="keyword">function</span> <span class="title">if</span></span></div><div class="line"><span class="title">in</span> <span class="title">local</span> <span class="title">nil</span> <span class="title">not</span> <span class="title">or</span></div><div class="line"><span class="title">repeat</span> <span class="title">return</span> <span class="title">then</span> <span class="title">true</span> <span class="title">until</span></div><div class="line"><span class="title">while</span></div></pre></td></tr></table></figure>
<p>与jass很像不是吗?</p>
<p>##6.值之间的操作</p>
<p>####运算<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span> + <span class="number">2</span> == <span class="number">3</span></div><div class="line"><span class="number">3</span> * <span class="number">4</span> == <span class="number">12</span></div><div class="line"><span class="number">2</span> - <span class="number">6</span> == <span class="number">-4</span></div><div class="line"><span class="number">7</span> / <span class="number">2</span> == <span class="number">3.5</span></div><div class="line"><span class="number">4</span> ^ <span class="number">2</span> == <span class="number">16</span></div><div class="line"><span class="number">5</span> % <span class="number">1.5</span> == <span class="number">0.5</span></div><div class="line"><span class="number">1</span> .. <span class="number">1</span> == <span class="string">"11"</span></div><div class="line"><span class="string">"6"</span> + <span class="string">"7"</span> == <span class="number">13</span></div></pre></td></tr></table></figure></p>
<p>lua在必要的时候会自动转换类型,因此需要特别留意字符串是通过 .. 来连接的</p>
<p>此外lua还自带了 幂(^) 与 取模(%)</p>
<p>####逻辑<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> x == <span class="literal">true</span> <span class="keyword">then</span> <span class="comment">--1</span></div><div class="line">	a = <span class="number">1</span></div><div class="line"><span class="keyword">elseif</span> x <span class="keyword">then</span> <span class="comment">--2</span></div><div class="line">	a = <span class="number">2</span></div><div class="line"><span class="keyword">elseif</span> <span class="keyword">not</span> x <span class="keyword">then</span> <span class="comment">--3</span></div><div class="line">	a = <span class="number">3</span></div><div class="line"><span class="keyword">elseif</span> x <span class="keyword">and</span> y <span class="keyword">then</span> <span class="comment">--4</span></div><div class="line">	a = <span class="number">4</span></div><div class="line"><span class="keyword">elseif</span> x <span class="keyword">or</span> y <span class="keyword">then</span> <span class="comment">--5</span></div><div class="line">	a = <span class="number">5</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure></p>
<p>lua的if结构与jass相似,只要注意endif要改成end</p>
<p>第2个条件中,只有当x的值为nil或false才不成立,其他情况包括0或””都是成立的</p>
<p>##7.变量</p>
<p>lua对变量进行操作时不需要 set 关键字</p>
<p>lua使用全局变量无须事先声明,任何时候<figure class="highlight plain"><figcaption><span>= 10```都是有效的.在a被赋值前,如果去获取a的值将返回"nil"</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">局部变量的声明方式类似于jass:</div><div class="line"></div><div class="line">```lua</div><div class="line">	local a = 10</div></pre></td></tr></table></figure></p>
<p>局部变量可以在任何位置声明,影响范围由声明的位置而定,例如:<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> a = <span class="number">10</span></div><div class="line"><span class="keyword">if</span> a <span class="keyword">then</span></div><div class="line">	<span class="keyword">local</span> a = <span class="number">20</span></div><div class="line">	<span class="built_in">print</span>(a)</div><div class="line"><span class="keyword">end</span></div><div class="line"><span class="built_in">print</span>(a)</div></pre></td></tr></table></figure></p>
<p>将依次显示20与10</p>
<p>记住,lua不需要写变量类型哦</p>
<p>你可以一次声明多个变量</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x, y = <span class="number">10</span>, <span class="number">20</span> <span class="comment">--x = 10, y = 20</span></div><div class="line">x, y , z = <span class="number">10</span>, <span class="number">20</span> <span class="comment">--x = 10, y = 20, z = nil</span></div><div class="line">x, y = <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span> <span class="comment">--x = 10, y = 20, 30被丢弃</span></div><div class="line">x, y = y, x <span class="comment">--x = 20, y = 10</span></div></pre></td></tr></table></figure>
<p>##8.字符串</p>
<p>lua的字符串有3种符号,例:<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">	text1 = <span class="string">"I'm hungry"</span></div><div class="line">	text2 = <span class="string">'"That loli seems delicacies!", I said'</span></div><div class="line">	text3 = <span class="string">[[</span></div><div class="line">"呜喵"\n"呜喵"\n"呜喵"</div><div class="line">	]]</div></pre></td></tr></table></figure></p>
<p>其中用[[]]表示的字符串将忠实的记录你输入的文字,忽略其中的任何转义符.如果你<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">```</div><div class="line">&quot;呜喵&quot;\n&quot;呜喵&quot;\n&quot;呜喵&quot;</div></pre></td></tr></table></figure></p>
<p>需要注意的是,[[]]形式的字符串可能会与你的脚本产生一些冲突,例如<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">text = <span class="string">[[</span></div><div class="line">	a = t[v[5]]</div><div class="line">]]</div></pre></td></tr></table></figure></p>
<p>你可以改写成如下的形式<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">text = <span class="string">[===[</span></div><div class="line">	a = t[v[5]]</div><div class="line">]===]</div></pre></td></tr></table></figure></p>
<p>这样lua只会把拥有相同等号数量的括号认为是一组</p>
<p>同样的,你可以将YDWE内写lua的代码改成如下代码:<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?import(filename)<span class="string">[=====[</span></div><div class="line"></div><div class="line">	script</div><div class="line">	</div><div class="line">]=====]?&gt;</div></pre></td></tr></table></figure></p>
<p>以回避一些冲突</p>
<p>##9.简单循环</p>
<p>lua有3种简单循环方式</p>
<p>####① for循环</p>
<p>最常用的循环方式</p>
<p>直接看例子</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">5</span> <span class="keyword">do</span></div><div class="line">	<span class="built_in">print</span>(i)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>将依次打印 1, 2, 3, 4, 5</p>
<p>你也可以指定循环的步长</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span> <span class="keyword">do</span></div><div class="line">	<span class="built_in">print</span>(i)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>将依次打印 1, 3, 5</p>
<p>需要注意的是,你无法通过修改i的值来控制循环</p>
<p>####② while循环</p>
<p>当条件成立时进行循环</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> i = <span class="number">1</span></div><div class="line"><span class="keyword">while</span> i &lt;= <span class="number">5</span> <span class="keyword">do</span></div><div class="line">	<span class="built_in">print</span>(i)</div><div class="line">	i = i + <span class="number">1</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>####③ repeat循环</p>
<p>当条件成立时退出循环</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> i = <span class="number">1</span></div><div class="line"><span class="keyword">repeat</span></div><div class="line">	<span class="built_in">print</span>(i)</div><div class="line">	i = i + <span class="number">1</span></div><div class="line"><span class="keyword">until</span> i &gt; <span class="number">5</span></div></pre></td></tr></table></figure>
<p>以上三种循环你都可以使用break来提前退出,常见的用法有</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> i = <span class="number">1</span></div><div class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></div><div class="line">	<span class="built_in">print</span>(i)</div><div class="line">	i = i + <span class="number">1</span></div><div class="line">	<span class="keyword">if</span> i &gt; <span class="number">5</span> <span class="keyword">then</span></div><div class="line">		<span class="keyword">break</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>需要注意的是,break必须放在一段代码的最后面</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></div><div class="line">	<span class="keyword">break</span> <span class="comment">--错误,后面还有代码</span></div><div class="line">	<span class="keyword">local</span> i</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></div><div class="line">	<span class="keyword">do</span> <span class="keyword">break</span> <span class="keyword">end</span> <span class="comment">--正确.do XXX end是一段完整的代码,break确实放在了这段代码的最后面</span></div><div class="line">	<span class="keyword">local</span> i</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>##10.简单的数据结构</p>
<p>lua只有一种数据结构:table(表)</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">t = &#123;&#125; <span class="comment">--创建一张表并赋值给变量t</span></div><div class="line"></div><div class="line">t[<span class="number">1</span>] = <span class="number">10</span></div><div class="line">t[<span class="number">2</span>] = <span class="number">20</span></div></pre></td></tr></table></figure>
<p>任何非nil的值都可以作为table的索引</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">t = &#123;&#125;</div><div class="line"></div><div class="line">t[<span class="string">"x"</span>] = <span class="number">10</span></div><div class="line">t[<span class="literal">true</span>] = <span class="number">20</span></div><div class="line">t[<span class="number">1.23</span>] = <span class="number">30</span></div><div class="line">t[t] = t</div><div class="line">t[GetTriggerUnit()] = <span class="string">"呜喵"</span></div></pre></td></tr></table></figure>
<p>在lua中,可以将<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">```lua</div><div class="line">	t[&quot;x&quot;] == t.x</div><div class="line">	t[&quot;1&quot;] ~= t[1]</div></pre></td></tr></table></figure></p>
<p>你可以在创建table的时候直接定义其数组内容,注意lua中的数组索引是从1开始的(jass是0),多个元素之间需要用逗号隔开</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">t = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125; <span class="comment">--相当于t[1] = 1, t[2] = 2, t[3] = 3, t[4] = 4, t[5] = 5</span></div><div class="line">t = &#123;x = <span class="number">10</span>, y = <span class="number">20</span>&#125; <span class="comment">--相当于t.x = 10, t.y = 20</span></div><div class="line"></div><div class="line">t = &#123;</div><div class="line">	<span class="number">1</span>,        <span class="comment">-- t[1] = 1</span></div><div class="line">	x = <span class="number">10</span>,   <span class="comment">-- t.x = 10</span></div><div class="line">	y = <span class="number">20</span>,   <span class="comment">-- t.y = 20</span></div><div class="line">	<span class="number">2</span>         <span class="comment">-- t[2] = 2</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过嵌套table,你可以很简单的构造出多维数组</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">t = &#123;&#125;</div><div class="line">t[<span class="number">1</span>] = &#123;&#125;</div><div class="line">t[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">"呜喵"</span></div></pre></td></tr></table></figure>
<p>随着你对lua的深入,你可能会越来越多的使用这样的结构:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">hero = &#123;</div><div class="line">	name = <span class="string">"虐农先锋"</span>,</div><div class="line">	hp = &#123;<span class="number">500</span>, <span class="number">1000</span>&#125;,</div><div class="line">	mp = &#123;<span class="number">200</span>, <span class="number">300</span>&#125;,</div><div class="line">	[<span class="string">"坐标"</span>] = &#123;<span class="number">50</span>, <span class="number">100</span>&#125;,</div><div class="line">	[<span class="string">"技能"</span>] = &#123;</div><div class="line">		[<span class="string">"风暴之锤"</span>] =&#123;</div><div class="line">			id = |A000|,</div><div class="line">			mp = <span class="number">75</span>,</div><div class="line">			cd = &#123;<span class="number">10</span>, <span class="number">8</span>, <span class="number">6</span>&#125;</div><div class="line">		&#125;,</div><div class="line">		[<span class="string">"雷霆一击"</span>] =&#123;</div><div class="line">			id = |A001|,</div><div class="line">			mp = &#123;<span class="number">90</span>, <span class="number">100</span>, <span class="number">120</span>&#125;,</div><div class="line">			cd = &#123;<span class="number">15</span>, <span class="number">14</span>, <span class="number">13</span>&#125;</div><div class="line">		&#125;,</div><div class="line">	&#125;,</div><div class="line">	[<span class="string">"移动速度"</span>] = <span class="number">270</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##11.函数的声明</p>
<p>lua的函数声明有2种形式:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">(a, b, c)</span></span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">func = <span class="function"><span class="keyword">function</span><span class="params">(a, b, c)</span></span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这2种声明方式是完全等价的,都是声明了一个名字为”func”,参数为”a, b, c”的函数</p>
<p>显然这里的参数不需要填写类型,函数也不需要声明返回值的类型,顺便将endfunction改为end即可</p>
<p>从第二种声明方式中我们可以看出,lua中的函数是可以赋值给变量的:我声明了一个新的函数,然后将其赋值给变量”func”</p>
<p>一个简单的函数重载:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">R2I = math.floor <span class="comment">--math.floor是lua自带的取整函数</span></div><div class="line">R2I(<span class="number">1.5</span>) <span class="comment">--会去调用lua的math.floor而不是jass的R2I</span></div></pre></td></tr></table></figure>
<p>既然是变量,那么他也就可以局部化:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">local</span> func1 = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></div><div class="line">		<span class="keyword">return</span> <span class="number">1</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"></div><div class="line">	<span class="keyword">local</span> func2 = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></div><div class="line">		<span class="keyword">return</span> <span class="number">2</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(func1()) <span class="comment">-- 0</span></div><div class="line"><span class="built_in">print</span>(func1()) <span class="comment">-- 0</span></div><div class="line"><span class="built_in">print</span>(func2()) <span class="comment">-- func2不存在</span></div></pre></td></tr></table></figure>
<p>lua不限定函数的返回值,你可以返回或不返回;返回一个或返回多个;返回布尔或返回整数:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">(a)</span></span></div><div class="line">	<span class="keyword">if</span> a = <span class="number">1</span> <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> <span class="number">1</span></div><div class="line">	<span class="keyword">elseif</span> a == <span class="number">2</span> <span class="keyword">then</span></div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>, <span class="string">"wumiao"</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(func(<span class="number">1</span>)) <span class="comment">-- 1</span></div><div class="line"><span class="built_in">print</span>(func(<span class="number">2</span>)) <span class="comment">-- 1	wumiao</span></div><div class="line"><span class="built_in">print</span>(func(<span class="number">3</span>)) <span class="comment">-- nil</span></div></pre></td></tr></table></figure>
<p>需要注意的是,与break一样,return必须放在一段代码的最后面</p>
<p>##12.函数的调用</p>
<p>lua调用函数显然是不需要写call这个关键字的,而且函数作为一个变量,只要他被赋值了你就可以去调用他,因此也没有声明顺序的问题</p>
<p>不过你依然需要关注一下局部函数的有效范围:</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> func = <span class="function"><span class="keyword">function</span><span class="params">(a)</span></span></div><div class="line">	a = a <span class="keyword">or</span> <span class="number">1</span></div><div class="line">	<span class="keyword">if</span> a &lt; <span class="number">10</span> <span class="keyword">then</span></div><div class="line">		func(a + <span class="number">1</span>) <span class="comment">-- 错误,函数"func"没有被声明</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>正确的写法应该是</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">local</span> func</div><div class="line">func = <span class="function"><span class="keyword">function</span><span class="params">(a)</span></span></div><div class="line">	a = a <span class="keyword">or</span> <span class="number">1</span></div><div class="line">	<span class="keyword">if</span> a &lt; <span class="number">10</span> <span class="keyword">then</span></div><div class="line">		func(a + <span class="number">1</span>)</div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>lua不关心你调用函数时的参数是否与函数声明时的参数一致,多余的参数被抛弃,不足的参数为nil,类似于多变量赋值</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">func = <span class="function"><span class="keyword">function</span><span class="params">(a, b, c)</span></span></div><div class="line">	<span class="built_in">print</span>(a)</div><div class="line">	<span class="built_in">print</span>(b)</div><div class="line">	<span class="built_in">print</span>(c)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">func(<span class="number">1</span>) <span class="comment">-- 1, nil, nil</span></div><div class="line"></div><div class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) <span class="comment">-- 1, 2, 3</span></div></pre></td></tr></table></figure>
<p>同样的,一个拥有多返回值的函数也有类似的情况:<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">func = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></div><div class="line">	<span class="keyword">return</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">a, b, c = func() <span class="comment">-- a = 1, b = 2, c = 3</span></div><div class="line">a, b = func() <span class="comment">-- a = 1, b = 2, 3被抛弃</span></div><div class="line">a, b, c, d = func() <span class="comment">-- a = 1, b = 2, c = 3, d = nil</span></div></pre></td></tr></table></figure></p>
<p>##13.表的简单操作</p>
<p>jass中是直接定义某个变量为数组的,而lua中则是将一个表赋值给一个变量,显然表也可以作为一个普通的对象进行传递</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">t = &#123;[<span class="number">0</span>] = <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, x = <span class="number">10</span>, y = <span class="number">20</span>, z = <span class="number">30</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>&#125;</div></pre></td></tr></table></figure>
<p>这张表分为了2个部分,数组与哈希表.lua对数组的定义是从索引1开始的连续元素,因此t[0]是哈希表部分,而将t[3]截断后,之后元素不再连续,此时的数组大小便为2.我们可以通过符号#来获取数组部分的长度</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(#t) <span class="comment">-- 5</span></div><div class="line"></div><div class="line">t[<span class="number">3</span>] = <span class="literal">nil</span></div><div class="line"><span class="built_in">print</span>(#t) <span class="comment">-- 2</span></div></pre></td></tr></table></figure>
<p>有2种简单的方式来遍历表的数组部分</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i = <span class="number">1</span>, #t <span class="keyword">do</span></div><div class="line">	<span class="built_in">print</span>(i .. <span class="string">":"</span> .. t[i]) <span class="comment">--显示 1:2, 2:4, 3:6, 4:8, 5:10</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t) <span class="keyword">do</span></div><div class="line">	<span class="built_in">print</span>(i .. <span class="string">":"</span> .. v) <span class="comment">--显示同上</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>第二种方式也是循环的一种,既然循环,他也可以用过break来提前退出</p>
<p>lua也提供了1种简单的方式来遍历表的所有元素</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></div><div class="line">	<span class="built_in">print</span>(i .. <span class="string">":"</span> .. v) <span class="comment">--可能显示 1:2, 2:4, 3:6, 4:8, 5:10, x:10, y:20, z:30</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在例子中我之所说是可能显示,是因为哈希表部分的遍历顺序是随机的,与你存储的顺序无关.不过他依然会按照顺序先遍历出数组的部分</p>
<p>lua提供了2个常用的插入/移除函数:table.insert与table.remove</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">t = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</div><div class="line"></div><div class="line">table.insert(t, <span class="number">2</span>, <span class="number">4</span>) <span class="comment">--将4插入到t[2]的位置,之前从t[2]开始的元素都被挤得往后挪一个位置,变为&#123;1, 4, 2, 3&#125;</span></div><div class="line"></div><div class="line">table.insert(t, <span class="number">5</span>) <span class="comment">--在t的末端添加元素,变为&#123;1, 4, 2, 3, 5&#125;</span></div><div class="line"></div><div class="line">table.<span class="built_in">remove</span>(t, <span class="number">2</span>) <span class="comment">--移除t[3],之前从t[4]开始的元素都向前移动一个位置填补空缺,变为&#123;1, 4, 3, 5&#125;</span></div><div class="line"></div><div class="line">table.<span class="built_in">remove</span>(t) <span class="comment">--移除t末端的元素,变为&#123;1, 4, 3&#125;</span></div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2014/05/thought-report/" class="prev">上一篇</a><a href="/2014/04/warcraft3-8mb-patch/" class="next">下一篇</a></div><div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div><script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><script>var url = document.location.href;
if (url.substring(url.length-1) == '/') {
    url = url.substring(0, url.length-1)
};
var cloudTieConfig = {
  url: url,
  sourceId: "",
  productKey: "04f8b460aaca4ca08df51bb3e40f6025",
  target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);</script><div class="copyright"><p>© 2014 - 2017 <a href="http://www.ydwe.net">actboy168</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script type="text/javascript" src="http://tajs.qq.com/stats?sId=9212054" charset="UTF-8"></script></body></html>